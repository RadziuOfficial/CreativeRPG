--[[
ZAKAZ UŻYWANIA PONIŻSZEGO KODU
@WSZELKIE PRAWA ZASTRZEŻONE, CREATIVERPG.
AUTHOR:
- RAD3K @2018
- ALTEX @2018
ZAKAZ UŻYWANIA BEZ ZGODY AUTORA!
]]--

local code = "Autobusy"
local districtsBus 
local districtsBus = {
{ 2794.42, 1315.15, 10.48, 0.00, 0.00, 91.12},
{ 2700.96, 1315.54, 13.26, 358.37, 0.01, 90.56},
{ 2550.21, 1315.74, 10.40, 359.39, 359.96, 90.29},
{ 2434.96, 1315.55, 10.45, 1.41, 0.66, 89.51},
{ 2429.41, 1405.91, 10.40, 359.83, 360.00, 0.28},
{ 2422.80, 1474.73, 10.66, 357.71, 358.97, 67.08},
{ 2370.25, 1477.18, 10.52, 359.69, 0.99, 60.50},
{ 2370.07, 1535.73, 10.48, 358.65, 0.57, 41.72},
{ 2260.29, 1536.11, 10.40, 0.23, 0.01, 90.98},
{ 2071.19, 1534.98, 10.40, 359.30, 359.73, 87.27},
{ 2069.70, 1637.70, 10.41, 0.22, 0.15, 359.51},
{ 2135.90, 1833.63, 10.40, 1.14, 0.18, 334.69},
{ 2149.94, 1973.70, 10.41, 359.88, 360.00, 359.52},
{ 2149.65, 2096.37, 10.41, 359.40, 0.00, 359.98},
{ 2150.16, 2226.05, 10.40, 359.40, 360.00, 359.02},
{ 2189.07, 2320.53, 10.40, 0.12, 0.02, 320.50},
{ 2181.74, 2347.10, 10.40, 360.00, 0.00, 92.59},
{ 2127.14, 2355.13, 10.40, 0.00, 360.00, 100.95},
{ 2092.87, 2313.82, 10.41, 359.88, 0.10, 188.62},
{ 2122.35, 2246.18, 10.40, 359.84, 0.02, 195.73},
{ 2126.10, 2124.03, 10.40, 359.38, 359.92, 179.91},
{ 2033.34, 2115.64, 10.40, 359.83, 0.00, 89.58},
{ 1930.26, 2117.27, 10.52, 359.40, 0.84, 65.85},
{ 1930.01, 2220.76, 10.40, 0.23, 360.00, 0.16},
{ 1929.55, 2384.85, 10.40, 359.39, 359.96, 0.09},
{ 2018.49, 2391.23, 10.44, 0.63, 0.71, 270.57},
{ 2029.17, 2447.74, 10.50, 0.56, 359.80, 356.97},
{ 2108.74, 2450.64, 10.40, 0.23, 359.99, 270.20},
{ 2218.90, 2451.02, 10.46, 1.83, 0.53, 270.06},
{ 2232.61, 2509.02, 10.40, 359.85, 0.03, 312.25},
{ 2342.64, 2510.85, 10.40, 359.75, 0.02, 270.18},
{ 2364.98, 2493.61, 10.40, 0.00, 0.00, 175.85},
{ 2365.45, 2412.93, 10.54, 359.30, 1.02, 209.24},
{ 2473.09, 2411.08, 10.40, 359.83, 0.17, 270.27},
{ 2525.22, 2401.22, 10.41, 0.00, 0.00, 153.90},
{ 2524.52, 2289.71, 10.40, 359.84, 359.76, 179.89},
{ 2524.78, 2126.87, 10.40, 359.53, 0.00, 180.01},
{ 2547.73, 2110.71, 10.40, 359.86, 360.00, 272.67},
{ 2663.95, 2110.43, 10.82, 4.78, 0.05, 269.66},
{ 2804.20, 2111.26, 10.54, 357.14, 359.89, 270.91},
{ 2845.96, 2049.76, 10.40, 359.83, 360.00, 177.99},
{ 2815.71, 1968.88, 10.40, 359.84, 359.98, 119.37},
{ 2724.48, 1955.77, 13.50, 1.42, 359.61, 91.67},
{ 2594.21, 1955.18, 10.39, 359.99, 0.01, 91.60},
{ 2505.72, 1948.74, 10.51, 359.02, 360.00, 151.61},
{ 2505.02, 1839.26, 10.40, 359.90, 0.00, 179.64},
{ 2504.49, 1724.23, 10.40, 359.99, 0.00, 179.32},
{ 2543.87, 1706.77, 10.40, 359.87, 0.04, 210.19},
{ 2545.97, 1614.02, 10.59, 359.98, 2.10, 191.87},
{ 2603.32, 1606.97, 10.40, 0.48, 359.51, 218.71},
{ 2604.93, 1514.90, 10.40, 359.87, 0.00, 180.46},
{ 2589.25, 1476.53, 10.41, 0.39, 359.98, 91.77},
{ 2545.43, 1451.05, 10.40, 0.00, 360.00, 176.40},
{2553.79, 1371.25, 10.48, 358.74, 0.28, 241.02},
{2623.35, 1367.25, 10.40, 359.87, 0.07, 217.42},
{2625.19, 1318.49, 10.64, 2.90, 0.25, 187.23},
{2719.28, 1310.61, 13.64, 358.45, 359.98, 269.28},
{2794.25, 1311.05, 10.48, 0.00, 0.00, 269.67},
{2812.96, 1278.85, 10.48, 0.00, 0.00, 82.79},
}


local districtsBus2 = {
{ 2794.60, 1315.36, 10.48, 0.00, 0.00, 90.00},
{ 2706.42, 1315.88, 13.40, 358.36, 360.00, 89.94},
{ 2600.04, 1315.95, 10.40, 0.29, 0.00, 90.04},
{ 2491.41, 1315.73, 10.41, 359.82, 360.00, 90.22},
{ 2424.34, 1305.69, 10.44, 358.75, 359.80, 144.17},
{ 2424.92, 1219.82, 10.40, 359.83, 0.00, 180.90},
{ 2380.52, 1195.57, 10.40, 0.01, 360.00, 91.14},
{ 2281.62, 1196.06, 10.40, 359.86, 360.00, 89.52},
{ 2166.08, 1195.58, 10.40, 359.83, 359.99, 90.36},
{ 2078.51, 1195.04, 10.41, 359.85, 0.00, 90.36},
{ 2044.76, 1160.99, 10.40, 359.85, 0.07, 185.72},
{ 2029.69, 1095.72, 10.40, 359.89, 359.75, 91.38},
{ 1938.00, 1096.04, 10.40, 0.35, 360.00, 89.29},
{ 1870.22, 1107.39, 10.40, 359.84, 359.85, 9.10},
{ 1846.20, 1135.27, 11.19, 4.52, 359.83, 89.40},
{ 1725.91, 1136.05, 10.40, 359.84, 360.00, 89.70},
{ 1614.58, 1135.93, 10.40, 359.84, 359.99, 90.37},
{ 1514.98, 1135.58, 10.44, 0.56, 0.37, 76.85},
{ 1505.02, 1091.34, 10.40, 0.43, 0.00, 179.30},
{ 1505.07, 965.03, 10.40, 359.84, 360.00, 180.03},
{ 1529.06, 910.69, 10.40, 359.86, 0.02, 269.01},
{ 1564.75, 894.56, 11.01, 4.65, 0.37, 179.16},
{ 1565.18, 779.04, 10.35, 0.58, 0.18, 180.61},
{ 1565.76, 689.01, 10.40, 359.87, 360.00, 183.55},
{ 1531.42, 659.49, 10.49, 0.03, 1.00, 38.62},
{ 1481.55, 709.59, 10.40, 359.94, 359.91, 99.67},
{ 1452.74, 648.49, 10.50, 0.30, 357.04, 271.03},
{ 1541.97, 650.41, 10.40, 359.87, 359.99, 269.88},
{ 1569.81, 699.65, 10.40, 0.48, 0.00, 0.16},
{ 1570.00, 813.02, 12.48, 4.07, 0.06, 359.21},
{ 1569.55, 924.24, 10.43, 0.24, 359.75, 0.00},
{ 1569.88, 1042.77, 10.42, 359.18, 0.08, 2.39},
{ 1567.28, 1130.62, 10.59, 359.48, 0.12, 23.16},
{ 1464.99, 1135.14, 10.40, 359.39, 360.00, 90.41},
{ 1449.73, 1184.97, 10.40, 0.00, 0.00, 13.32},
{ 1360.45, 1195.51, 10.40, 359.89, 359.98, 90.46},
{ 1229.42, 1195.58, 13.37, 1.51, 360.00, 90.04},
{ 1088.24, 1195.49, 10.40, 0.16, 0.00, 90.04},
{ 1009.52, 1218.86, 10.40, 359.70, 359.97, 1.94},
{ 1009.97, 1321.84, 10.40, 0.16, 0.00, 359.57},
{ 1010.10, 1446.89, 10.41, 359.82, 359.99, 0.64},
{ 1009.55, 1564.99, 10.40, 0.19, 0.00, 358.98},
{ 1009.50, 1686.88, 10.50, 359.85, 0.00, 359.94},
{ 1009.63, 1800.02, 10.40, 359.40, 360.00, 359.94},
{ 1079.37, 1810.72, 10.40, 359.83, 0.00, 269.55},
{ 1195.77, 1810.65, 13.05, 3.68, 360.00, 270.04},
{ 1313.04, 1810.78, 10.39, 359.84, 359.91, 271.37},
{ 1330.17, 1864.26, 10.40, 0.44, 359.76, 352.77},
{ 1420.81, 1870.99, 10.40, 359.85, 0.10, 271.55},
{ 1538.88, 1870.83, 10.40, 359.94, 0.00, 269.54},
{ 1637.20, 1871.45, 10.42, 0.19, 0.04, 267.06},
{ 1645.15, 1803.09, 10.40, 0.36, 0.02, 179.75},
{ 1644.80, 1723.14, 10.41, 0.22, 0.45, 179.75},
{ 1706.33, 1711.06, 10.41, 0.19, 0.00, 270.33},
{ 1821.52, 1711.02, 12.91, 355.73, 359.98, 269.35},
{ 1963.69, 1710.96, 10.40, 0.06, 0.00, 270.66},
{ 2039.42, 1707.76, 10.40, 359.84, 359.99, 225.11},
{ 2045.54, 1604.99, 10.40, 0.24, 0.00, 180.17},
{ 2046.06, 1427.78, 10.40, 0.17, 0.00, 180.17},
{ 2046.59, 1245.18, 10.40, 0.19, 0.00, 180.17},
{ 2046.24, 1086.91, 10.40, 359.92, 359.97, 180.83},
{ 2059.28, 969.97, 10.19, 358.88, 0.81, 235.92},
{ 2138.49, 970.76, 10.42, 0.93, 0.01, 270.07},
{ 2281.84, 971.12, 10.49, 1.21, 0.00, 270.17},
{ 2350.77, 1002.98, 10.42, 359.02, 0.01, 0.23},
{ 2360.77, 1070.39, 10.40, 360.00, 360.00, 280.36},
{ 2458.91, 1070.84, 10.40, 359.85, 359.99, 270.63},
{ 2530.20, 1090.56, 10.40, 359.90, 0.11, 7.38},
{ 2529.21, 1205.33, 10.32, 359.07, 359.87, 0.85},
{ 2542.95, 1311.42, 10.40, 359.86, 0.05, 267.33},
{ 2661.00, 1311.24, 10.61, 4.09, 0.01, 269.82},
{ 2780.97, 1310.86, 10.46, 0.43, 0.00, 269.82},
{2812.96, 1278.85, 10.48, 0.00, 0.00, 82.79},
}


local districtsBus3 = {
{ 2794.97, 1315.48, 10.48, 0.00, 0.00, 88.69},
{ 2685.83, 1315.78, 12.37, 356.34, 359.98, 89.69},
{ 2625.56, 1286.71, 10.40, 0.51, 360.00, 178.93},
{ 2605.34, 1213.86, 10.40, 359.90, 359.83, 179.32},
{ 2604.73, 1092.77, 10.40, 359.40, 0.02, 180.58},
{ 2524.63, 1075.84, 10.73, 358.89, 1.33, 89.85},
{ 2387.12, 1075.39, 10.40, 359.85, 360.00, 90.10},
{ 2345.45, 1048.16, 10.40, 0.52, 360.00, 179.40},
{ 2331.12, 975.37, 10.40, 359.91, 0.17, 82.26},
{ 2215.07, 976.17, 10.40, 0.09, 0.00, 90.00},
{ 2088.89, 975.44, 10.40, 359.70, 0.00, 91.09},
{ 2069.25, 1051.93, 10.40, 0.21, 359.95, 1.05},
{ 2068.67, 1210.21, 10.40, 0.11, 0.01, 359.96},
{ 2068.78, 1363.23, 10.40, 0.20, 0.12, 359.96},
{ 2068.90, 1509.77, 10.40, 359.83, 0.00, 359.95},
{ 2063.97, 1647.22, 10.40, 0.35, 359.90, 1.47},
{ 2029.72, 1715.54, 10.40, 359.91, 0.01, 90.88},
{ 1943.11, 1714.96, 10.40, 0.13, 0.00, 90.80},
{ 1820.23, 1715.28, 12.97, 3.68, 359.97, 90.49},
{ 1692.39, 1715.14, 10.40, 0.20, 359.76, 89.05},
{ 1577.46, 1715.59, 10.40, 359.64, 359.71, 88.61},
{ 1570.28, 1816.62, 10.40, 359.91, 359.76, 359.54},
{ 1540.93, 1875.55, 10.40, 359.84, 359.94, 90.24},
{ 1421.93, 1875.79, 10.40, 359.83, 0.11, 89.74},
{ 1332.57, 1875.36, 10.40, 0.26, 0.57, 109.35},
{ 1306.53, 1815.50, 10.44, 1.78, 0.67, 80.48},
{ 1199.60, 1815.47, 13.22, 358.73, 359.97, 91.91},
{ 1042.30, 1814.79, 10.40, 359.84, 360.00, 90.23},
{ 1009.66, 1849.48, 10.50, 0.95, 1.44, 359.61},
{ 1010.33, 1941.58, 10.40, 0.02, 360.00, 356.53},
{ 922.64, 1955.60, 10.40, 359.40, 0.01, 88.65},
{ 909.86, 2029.29, 10.40, 0.22, 359.99, 0.54},
{ 909.61, 2184.73, 10.43, 1.10, 0.30, 358.44},
{ 923.10, 2291.32, 10.40, 0.09, 359.85, 270.59},
{ 1003.62, 2279.19, 10.40, 359.85, 359.64, 180.14},
{ 1004.53, 2173.20, 10.41, 359.80, 0.01, 181.52},
{ 1024.75, 2050.82, 10.40, 0.22, 0.69, 259.14},
{ 1175.31, 2051.05, 11.67, 4.10, 359.93, 271.23},
{ 1340.43, 2051.05, 10.40, 0.25, 0.01, 269.60},
{ 1503.46, 2050.97, 10.40, 359.88, 0.00, 269.95},
{ 1530.16, 2104.02, 10.40, 0.33, 0.00, 0.47},
{ 1549.77, 2170.31, 10.40, 0.37, 0.08, 269.12},
{ 1669.22, 2171.17, 10.40, 0.36, 0.00, 270.52},
{ 1764.15, 2163.42, 10.58, 359.33, 358.48, 213.94},
{ 1823.14, 2063.60, 10.56, 359.41, 359.99, 209.07},
{ 1903.35, 2040.21, 10.40, 359.86, 0.02, 266.25},
{ 1983.34, 2020.12, 10.40, 359.83, 360.00, 270.04},
{ 2111.37, 2020.21, 10.40, 359.92, 0.00, 270.05},
{ 2124.91, 1920.17, 10.40, 0.15, 0.00, 179.74},
{ 2089.79, 1794.37, 10.40, 359.87, 0.18, 153.85},
{ 2045.12, 1686.24, 10.40, 359.84, 359.99, 177.13},
{ 2045.60, 1553.32, 10.40, 359.49, 0.00, 180.24},
{ 2134.22, 1531.05, 10.40, 359.84, 359.87, 271.21},
{ 2252.92, 1531.10, 10.51, 358.68, 0.15, 269.93},
{ 2359.30, 1531.03, 10.45, 1.13, 0.00, 269.93},
{ 2365.01, 1481.31, 10.44, 1.33, 359.63, 193.82},
{ 2452.24, 1470.88, 10.40, 359.86, 0.14, 271.66},
{ 2590.26, 1471.29, 10.40, 0.08, 0.08, 270.20},
{ 2723.07, 1471.85, 13.55, 358.38, 360.00, 269.77},
{ 2822.89, 1464.17, 10.51, 359.82, 356.42, 203.48},
{2812.96, 1278.85, 10.48, 0.00, 0.00, 82.79},
}


local jobTarget
local jobMarker
local jobVehicle
local maxTarget = #districtsBus

function finishJob()
    if jobMarker and isElement(jobMarker) then
        destroyElement(jobMarker)
        jobMarker = nil
    end
    
    if jobTarget and isElement(jobTarget) then
        destroyElement(jobTarget)
        jobTarget = nil
        jobTarget = 0
        
    end  
if getElementData(localPlayer,"praca") == code then
setElementData(localPlayer,"praca",false)
end
triggerServerEvent("destroyVeh", localPlayer)
end
addEventHandler ( "onClientPlayerWasted", getLocalPlayer(),finishJob)


addEvent("finishJob",true)
addEventHandler("finishJob",root,function(plr)
if plr ~= localPlayer then return end
finishJob()
end)

function busDriver(el, md)
    if el ~= localPlayer or not md then return end
    if jobTarget > maxTarget and getPedOccupiedVehicle(el) then return end
    if jobTarget == maxTarget and not getPedOccupiedVehicle(el) then return end
	local hajs = getElementData(el, "pieniadze") or 0
	local gracz = math.random(5,10)	
	local premium = math.random(8,16)	    
    if jobTarget == #districtsBus then
        finishJob()
		exports["crpg_powiadomienia"]:noti("#00FF00✔#FFFFFF Praca została zakończona pomyślnie na trasie #FF0000"..trasa.."#FFFFFF.", el)		
    else
        showMarker()			
			if getElementData(el,"premium") then
		    setElementData(el, "pieniadze", hajs+premium)
		    exports["crpg_powiadomienia"]:noti("#FFFF00✪#FFFFFF Twoje wynagrodzenie wynosi "..premium.." PLN!", el)		
        else
		    setElementData(el, "pieniadze", hajs+gracz)
		    exports["crpg_powiadomienia"]:noti("#00FF00✔#FFFFFF Twoje wynagrodzenie wynosi "..gracz.." PLN!", el)	
        end		
    end
end

function showMarker()
    if jobMarker and isElement(jobMarker) then
        destroyElement(jobMarker)
        jobMarker = nil
    end
    
    jobTarget = jobTarget + 1
    jobMarker = createMarker(districtsBus[jobTarget][1], districtsBus[jobTarget][2], districtsBus[jobTarget][3], "checkpoint", 3.5, 0, 0, 255)
    
    if districtsBus[jobTarget+1] then
        ile = districtsBus[jobTarget+1]
        setMarkerTarget(jobMarker, ile[1], ile[2], ile[3])
    end
    
    addEventHandler("onClientMarkerHit", jobMarker, busDriver)
end

addEvent("STARTJobBus", true)
addEventHandler("STARTJobBus", resourceRoot, function(veh)
    trasa = math.random(1,3)
    if trasa==1 then
        districtsBus = districtsBus
    elseif trasa==2 then
        districtsBus = districtsBus2
    elseif trasa==3 then
        districtsBus = districtsBus3
    end
    maxTarget = #districtsBus
	exports["crpg_powiadomienia"]:noti("#00FF00✔#FFFFFF Praca została rozpoczęta na trasie #FF0000"..trasa.."#FFFFFF.")			
    jobVehicle = veh
    jobTarget = 0
    showMarker()
end)

addEventHandler("onClientResourceStop", resourceRoot, function()
    if jobVehicle and getElementData(localPlayer, "praca") then
        setElementData(localPlayer, "praca", false)
    end
end)


addEventHandler("onClientVehicleExit", resourceRoot, function(plr, seat)
    if seat == 0 then
        if plr == localPlayer then
            finishJob()
		    exports["crpg_powiadomienia"]:noti("#00FF00✔#FFFFFF Praca została zakończona pomyślnie na trasie #FF0000"..trasa.."#FFFFFF.", plr)
			setElementPosition(plr, 2841.19, 1290.91, 11.39)	
        end
    end
end)
